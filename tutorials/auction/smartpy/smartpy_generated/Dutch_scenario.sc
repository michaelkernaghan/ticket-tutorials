[{"shortname": "Test_Auction", "longname": "Test Auction", "scenario": [{"action": "html", "tag": "p", "inner": "[[TABLEOFCONTENTS]]", "line_no": 183}, {"action": "html", "tag": "h1", "inner": "Dutch Auction", "line_no": 190}, {"action": "newContract", "id": 0, "export": "(storage (record 85 (current_price (literal (intOrNat 0) 85)) (in_progress (literal (bool False) 88)) (owner (reduce (attr (account_of_seed \"Alice\" 186) \"address\" 186) 186)) (reserve_price (literal (intOrNat 0) 85)) (round_time (literal (intOrNat 0) 85)) (start_time (literal (timestamp 0) 89)) (ticket (variant \"None\" (unit) -1)))\nstorage_type ((record ((current_price \"nat\") (in_progress \"bool\") (owner \"address\") (reserve_price \"nat\") (round_time \"int\") (start_time \"timestamp\") (ticket (option (ticket \"nat\")))) None))\nmessages ((buy True ((set_type (params 138) \"address\" 139) (verify (attr (data) \"in_progress\" 140) False 140) (verify (invert (eq (sender) (attr (data) \"owner\" 141) 141) 141) False 141) (verify (eq (amount) (split_tokens (literal (mutez 1) 142) (attr (data) \"current_price\" 142) (literal (intOrNat 1) 142) 142) 142) False 142) (verify (lt (now) (add_seconds (attr (data) \"start_time\" 144) (attr (data) \"round_time\" 144) 144) 144) False 144) (set (operations 146) (cons (transfer (unit) (amount) (openVariant (contract \"\" \"unit\" (attr (data) \"owner\" 141) 146) \"Some\" \"None\" 146) 146) (operations 146) 146) 146) (set (operations 150) (cons (transfer (openVariant (attr (data) \"ticket\" 150) \"Some\" \"None\" 150) (literal (mutez 0) 150) (openVariant (contract \"receiveNft\" (ticket \"nat\") (params 138) 149) \"Some\" \"None\" 149) 150) (operations 150) 150) 150) (set (attr (data) \"ticket\" 150) (variant \"None\" (unit) -1) 153) (set (attr (data) \"in_progress\" 140) (literal (bool False) 154) 154))) (cancelAuction True ((verify (attr (data) \"in_progress\" 140) False (literal (string \"No Auction in progress\") 158) 158) (verify (eq (sender) (attr (data) \"owner\" 141) 159) False (literal (string \"User not Authorized\") 159) 159) (set (attr (data) \"current_price\" 142) (literal (intOrNat 0) 160) 160) (set (operations 164) (cons (transfer (openVariant (attr (data) \"ticket\" 150) \"Some\" \"None\" 150) (literal (mutez 0) 164) (openVariant (contract \"receiveNft\" (ticket \"nat\") (attr (data) \"owner\" 141) 163) \"Some\" \"None\" 163) 164) (operations 164) 164) 164) (set (attr (data) \"ticket\" 150) (variant \"None\" (unit) -1) 166) (set (attr (data) \"in_progress\" 140) (literal (bool False) 167) 167))) (configureAuction True ((set_type (params 101) (record ((opening_price \"nat\") (reserve_price \"nat\") (round_time \"int\") (start_time \"timestamp\") (ticket (ticket \"nat\"))) None) 102) (verify (eq (source) (attr (data) \"owner\" 141) 103) False (literal (string \"User Not Authorized\") 103) 103) (verify (invert (attr (data) \"in_progress\" 140) 104) False (literal (string \"Auction in progress\") 104) 104) (set (attr (data) \"current_price\" 142) (attr (params 101) \"opening_price\" 106) 106) (set (attr (data) \"reserve_price\" 107) (attr (params 101) \"reserve_price\" 107) 107) (set (attr (data) \"start_time\" 144) (attr (params 101) \"start_time\" 108) 108) (set (attr (data) \"round_time\" 144) (attr (params 101) \"round_time\" 109) 109) (set (attr (data) \"ticket\" 150) (variant \"Some\" (attr (params 101) \"ticket\" 110) 110) 110))) (dropPrice True ((set_type (params 125) \"nat\" 126) (verify (eq (sender) (attr (data) \"owner\" 141) 127) False (literal (string \"User not Authorized\") 127) 127) (verify (attr (data) \"in_progress\" 140) False (literal (string \"No Auction in progress\") 128) 128) (verify (lt (params 125) (attr (data) \"current_price\" 142) 129) False (literal (string \"Price not dropped\") 129) 129) (verify (ge (params 125) (attr (data) \"reserve_price\" 107) 130) False (literal (string \"Price below reserve_price\") 130) 130) (verify (gt (now) (add_seconds (attr (data) \"start_time\" 144) (attr (data) \"round_time\" 144) 132) 132) False (literal (string \"Previous round has not ended\") 132) 132) (set (attr (data) \"current_price\" 142) (params 125) 134) (set (attr (data) \"start_time\" 144) (now) 135))) (startAuction True ((verify (eq (sender) (attr (data) \"owner\" 141) 114) False (literal (string \"User not Authorized\") 114) 114) (verify (invert (attr (data) \"in_progress\" 140) 115) False (literal (string \"Auction in progress\") 115) 115) (verify (isVariant (attr (data) \"ticket\" 150) \"Some\" 117) False (literal (string \"No ticket to auction\") 117) 117) (verify (ge (now) (attr (data) \"start_time\" 144) 119) False (literal (string \"Too early to start auction\") 119) 119) (set (attr (data) \"in_progress\" 140) (literal (bool True) 121) 121) (set (attr (data) \"start_time\" 144) (now) 122))))\nflags (edo)\nglobals ()\nviews ()\nentry_points_layout ()\ninitial_metadata ()\nbalance ())", "line_no": 194, "show": true, "accept_unknown_types": false}, {"action": "newContract", "id": 1, "export": "(storage (record 22 (admin (reduce (attr (account_of_seed \"Alice\" 186) \"address\" 186) 186)) (current_id (literal (intOrNat 0) 22)) (tickets (big_map 23 )) (token_metadata (big_map 25 )))\nstorage_type ((record ((admin \"address\") (current_id \"nat\") (tickets (bigmap \"nat\" (ticket \"nat\"))) (token_metadata (bigmap \"nat\" (tuple \"nat\" (map \"string\" \"bytes\"))))) None))\nmessages ((configNftAuction True ((verify (eq (sender) (attr (data) \"admin\" 64) 64) False 64) (set_type (params 63) (record ((auction_address \"address\") (opening_price \"nat\") (reserve_price \"nat\") (round_time \"int\") (start_time \"timestamp\") (ticket_id \"nat\")) None) 65) (match_tuple 71 (get_and_update (attr (data) \"tickets\" 71) (attr (params 63) \"ticket_id\" 71) (variant \"None\" (unit) -1) 71) \"match_pair_71_fst\" \"match_pair_71_snd\") (verify (isVariant (variant_arg \"match_pair_71_fst\" 71) \"Some\" 72) False (literal (string \"Ticket does not exist\") 72) 72) (set (attr (data) \"tickets\" 71) (variant_arg \"match_pair_71_snd\" 71) 73) (set (operations 80) (cons (transfer (record 74 (opening_price (attr (params 63) \"opening_price\" 74)) (reserve_price (attr (params 63) \"reserve_price\" 75)) (round_time (attr (params 63) \"round_time\" 77)) (start_time (attr (params 63) \"start_time\" 76)) (ticket (openVariant (variant_arg \"match_pair_71_fst\" 71) \"Some\" \"None\" 78))) (literal (mutez 0) 80) (openVariant (contract \"configureAuction\" (record ((opening_price \"nat\") (reserve_price \"nat\") (round_time \"int\") (start_time \"timestamp\") (ticket (ticket \"nat\"))) None) (attr (params 63) \"auction_address\" 79) 79) \"Some\" \"None\" 79) 80) (operations 80) 80) 80))) (createNft True ((set_type (params 28) (map \"string\" \"bytes\") 29) (verify (eq (sender) (attr (data) \"admin\" 64) 30) False 30) (defineLocal \"ticket_31\" (ticket (attr (data) \"current_id\" 31) (literal (intOrNat 1) 31) 31) 31) (set (attr (data) \"tickets\" 71) (update_map (attr (data) \"tickets\" 71) (attr (data) \"current_id\" 31) (variant \"Some\" (getLocal \"ticket_31\" 31) 33) 33) 34) (set (getItem (attr (data) \"token_metadata\" 35) (attr (data) \"current_id\" 31) 35) (tuple 35 (attr (data) \"current_id\" 31) (params 28)) 35) (set (attr (data) \"current_id\" 31) (add (attr (data) \"current_id\" 31) (literal (intOrNat 1) 36) 36) 36))) (receiveNft True ((set_type (params 39) (ticket \"nat\") 40) (match_tuple 41 (read_ticket (params 39) 41) \"match_pair_41_fst\" \"match_pair_41_snd\") (defineLocal \"compute_42\" (second (second (variant_arg \"match_pair_41_fst\" 41) 42) 42) 42) (defineLocal \"compute_43\" (first (variant_arg \"match_pair_41_fst\" 41) 43) 43) (defineLocal \"compute_44\" (first (second (variant_arg \"match_pair_41_fst\" 41) 44) 44) 44) (verify (eq (getLocal \"compute_42\" 42) (literal (intOrNat 1) 45) 45) False (literal (string \"Only send 1 Nft to this entrypoint\") 45) 45) (verify (eq (source) (attr (data) \"admin\" 64) 46) False (literal (string \"Ticket needs to be sent by wallet admin\") 46) 46) (set (attr (data) \"tickets\" 71) (update_map (attr (data) \"tickets\" 71) (attr (data) \"current_id\" 31) (variant \"Some\" (variant_arg \"match_pair_41_snd\" 41) 48) 48) 49) (set (attr (data) \"current_id\" 31) (add (attr (data) \"current_id\" 31) (literal (intOrNat 1) 50) 50) 50))) (sendNft True ((set_type (params 53) (record ((send_to (contract (ticket \"nat\"))) (ticket_id \"nat\")) None) 54) (verify (eq (sender) (attr (data) \"admin\" 64) 55) False 55) (match_tuple 56 (get_and_update (attr (data) \"tickets\" 71) (attr (params 53) \"ticket_id\" 56) (variant \"None\" (unit) -1) 56) \"match_pair_56_fst\" \"match_pair_56_snd\") (verify (isVariant (variant_arg \"match_pair_56_fst\" 56) \"Some\" 57) False (literal (string \"Ticket does not exist\") 57) 57) (set (attr (data) \"tickets\" 71) (variant_arg \"match_pair_56_snd\" 56) 59) (set (operations 60) (cons (transfer (openVariant (variant_arg \"match_pair_56_fst\" 56) \"Some\" \"None\" 60) (literal (mutez 0) 60) (attr (params 53) \"send_to\" 60) 60) (operations 60) 60) 60))))\nflags (edo)\nglobals ()\nviews ()\nentry_points_layout ()\ninitial_metadata ()\nbalance ())", "line_no": 199, "show": true, "accept_unknown_types": false}, {"action": "newContract", "id": 2, "export": "(storage (record 22 (admin (reduce (attr (account_of_seed \"Robert\" 187) \"address\" 187) 187)) (current_id (literal (intOrNat 0) 22)) (tickets (big_map 23 )) (token_metadata (big_map 25 )))\nstorage_type ((record ((admin \"address\") (current_id \"nat\") (tickets (bigmap \"nat\" (ticket \"nat\"))) (token_metadata (bigmap \"nat\" (tuple \"nat\" (map \"string\" \"bytes\"))))) None))\nmessages ((configNftAuction True ((verify (eq (sender) (attr (data) \"admin\" 64) 64) False 64) (set_type (params 63) (record ((auction_address \"address\") (opening_price \"nat\") (reserve_price \"nat\") (round_time \"int\") (start_time \"timestamp\") (ticket_id \"nat\")) None) 65) (match_tuple 71 (get_and_update (attr (data) \"tickets\" 71) (attr (params 63) \"ticket_id\" 71) (variant \"None\" (unit) -1) 71) \"match_pair_71_fst\" \"match_pair_71_snd\") (verify (isVariant (variant_arg \"match_pair_71_fst\" 71) \"Some\" 72) False (literal (string \"Ticket does not exist\") 72) 72) (set (attr (data) \"tickets\" 71) (variant_arg \"match_pair_71_snd\" 71) 73) (set (operations 80) (cons (transfer (record 74 (opening_price (attr (params 63) \"opening_price\" 74)) (reserve_price (attr (params 63) \"reserve_price\" 75)) (round_time (attr (params 63) \"round_time\" 77)) (start_time (attr (params 63) \"start_time\" 76)) (ticket (openVariant (variant_arg \"match_pair_71_fst\" 71) \"Some\" \"None\" 78))) (literal (mutez 0) 80) (openVariant (contract \"configureAuction\" (record ((opening_price \"nat\") (reserve_price \"nat\") (round_time \"int\") (start_time \"timestamp\") (ticket (ticket \"nat\"))) None) (attr (params 63) \"auction_address\" 79) 79) \"Some\" \"None\" 79) 80) (operations 80) 80) 80))) (createNft True ((set_type (params 28) (map \"string\" \"bytes\") 29) (verify (eq (sender) (attr (data) \"admin\" 64) 30) False 30) (defineLocal \"ticket_31\" (ticket (attr (data) \"current_id\" 31) (literal (intOrNat 1) 31) 31) 31) (set (attr (data) \"tickets\" 71) (update_map (attr (data) \"tickets\" 71) (attr (data) \"current_id\" 31) (variant \"Some\" (getLocal \"ticket_31\" 31) 33) 33) 34) (set (getItem (attr (data) \"token_metadata\" 35) (attr (data) \"current_id\" 31) 35) (tuple 35 (attr (data) \"current_id\" 31) (params 28)) 35) (set (attr (data) \"current_id\" 31) (add (attr (data) \"current_id\" 31) (literal (intOrNat 1) 36) 36) 36))) (receiveNft True ((set_type (params 39) (ticket \"nat\") 40) (match_tuple 41 (read_ticket (params 39) 41) \"match_pair_41_fst\" \"match_pair_41_snd\") (defineLocal \"compute_42\" (second (second (variant_arg \"match_pair_41_fst\" 41) 42) 42) 42) (defineLocal \"compute_43\" (first (variant_arg \"match_pair_41_fst\" 41) 43) 43) (defineLocal \"compute_44\" (first (second (variant_arg \"match_pair_41_fst\" 41) 44) 44) 44) (verify (eq (getLocal \"compute_42\" 42) (literal (intOrNat 1) 45) 45) False (literal (string \"Only send 1 Nft to this entrypoint\") 45) 45) (verify (eq (source) (attr (data) \"admin\" 64) 46) False (literal (string \"Ticket needs to be sent by wallet admin\") 46) 46) (set (attr (data) \"tickets\" 71) (update_map (attr (data) \"tickets\" 71) (attr (data) \"current_id\" 31) (variant \"Some\" (variant_arg \"match_pair_41_snd\" 41) 48) 48) 49) (set (attr (data) \"current_id\" 31) (add (attr (data) \"current_id\" 31) (literal (intOrNat 1) 50) 50) 50))) (sendNft True ((set_type (params 53) (record ((send_to (contract (ticket \"nat\"))) (ticket_id \"nat\")) None) 54) (verify (eq (sender) (attr (data) \"admin\" 64) 55) False 55) (match_tuple 56 (get_and_update (attr (data) \"tickets\" 71) (attr (params 53) \"ticket_id\" 56) (variant \"None\" (unit) -1) 56) \"match_pair_56_fst\" \"match_pair_56_snd\") (verify (isVariant (variant_arg \"match_pair_56_fst\" 56) \"Some\" 57) False (literal (string \"Ticket does not exist\") 57) 57) (set (attr (data) \"tickets\" 71) (variant_arg \"match_pair_56_snd\" 56) 59) (set (operations 60) (cons (transfer (openVariant (variant_arg \"match_pair_56_fst\" 56) \"Some\" \"None\" 60) (literal (mutez 0) 60) (attr (params 53) \"send_to\" 60) 60) (operations 60) 60) 60))))\nflags (edo)\nglobals ()\nviews ()\nentry_points_layout ()\ninitial_metadata ()\nbalance ())", "line_no": 200, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "Create NFT", "line_no": 202}, {"action": "message", "id": 1, "message": "createNft", "params": "(map 204 ((literal (string \"name\") 205) (literal (bytes \"0x4e667431\") 204)))", "line_no": 205, "title": "", "messageClass": "", "source": "none", "sender": "seed:Alice", "chain_id": "", "time": "(literal (timestamp 0) 17)", "amount": "(literal (mutez 0) 1)", "level": "(literal (intOrNat 0) 205)", "show": true, "valid": "(literal (bool True) 205)", "voting_powers": "(map 205 )"}, {"action": "html", "tag": "h2", "inner": "Configure and start auction", "line_no": 207}, {"action": "message", "id": 1, "message": "configNftAuction", "params": "(record 208 (auction_address (literal (local-address 0) 92)) (opening_price (literal (intOrNat 100) 208)) (reserve_price (literal (intOrNat 10) 208)) (round_time (literal (intOrNat 1000) 208)) (start_time (literal (timestamp 1571761674) 179)) (ticket_id (literal (intOrNat 0) 208)))", "line_no": 208, "title": "", "messageClass": "", "source": "seed:Alice", "sender": "seed:Alice", "chain_id": "", "time": "(literal (timestamp 1571761674) 179)", "amount": "(literal (mutez 0) 1)", "level": "(literal (intOrNat 0) 208)", "show": true, "valid": "(literal (bool True) 208)", "voting_powers": "(map 208 )"}, {"action": "verify", "condition": "(invert (contains (attr (contractData 1 208) \"tickets\" 214) (literal (intOrNat 0) 214) 214) 214)", "line_no": 214}, {"action": "message", "id": 0, "message": "startAuction", "params": "(record 216 )", "line_no": 216, "title": "", "messageClass": "", "source": "none", "sender": "seed:Alice", "chain_id": "", "time": "(add_seconds (literal (timestamp 1571761674) 179) (literal (intOrNat 1) 215) 215)", "amount": "(literal (mutez 0) 1)", "level": "(literal (intOrNat 0) 216)", "show": true, "valid": "(literal (bool True) 216)", "voting_powers": "(map 216 )"}, {"action": "message", "id": 0, "message": "dropPrice", "params": "(literal (intOrNat 90) 220)", "line_no": 220, "title": "", "messageClass": "", "source": "none", "sender": "seed:Alice", "chain_id": "", "time": "(add_seconds (add_seconds (literal (timestamp 1571761674) 179) (literal (intOrNat 1) 215) 215) (literal (intOrNat 6001) 218) 218)", "amount": "(literal (mutez 0) 1)", "level": "(literal (intOrNat 0) 220)", "show": true, "valid": "(literal (bool True) 220)", "voting_powers": "(map 220 )"}, {"action": "html", "tag": "h2", "inner": "Bob buys", "line_no": 222}, {"action": "message", "id": 0, "message": "buy", "params": "(literal (local-address 2) 22)", "line_no": 224, "title": "", "messageClass": "", "source": "seed:Robert", "sender": "seed:Robert", "chain_id": "", "time": "(add_seconds (add_seconds (add_seconds (literal (timestamp 1571761674) 179) (literal (intOrNat 1) 215) 215) (literal (intOrNat 6001) 218) 218) (literal (intOrNat 1) 223) 223)", "amount": "(literal (mutez 90) 224)", "level": "(literal (intOrNat 0) 224)", "show": true, "valid": "(literal (bool True) 224)", "voting_powers": "(map 224 )"}, {"action": "verify", "condition": "(contains (attr (contractData 2 200) \"tickets\" 225) (literal (intOrNat 0) 225) 225)", "line_no": 225}, {"action": "verify", "condition": "(invert (isVariant (attr (contractData 0 224) \"ticket\" 226) \"Some\" 226) 226)", "line_no": 226}]}]